import{r as v,A as w,i as F,l as $,N as P,O as I,P as L,o as O,b as m,g as x,u,d as f,e as r,t as c,q as U,J as K,p as z,n as R,v as T,F as j,h as D}from"./index-64eViR4o-1765275765937.js";function S(){return window.PublicKeyCredential!==void 0&&typeof window.PublicKeyCredential=="function"}async function V(){if(!S())return!1;try{return await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable()}catch(t){return console.error("Error checking platform authenticator:",t),!1}}function _(t){const e=new Uint8Array(t);let n="";for(let l=0;l<e.length;l++)n+=String.fromCharCode(e[l]);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function M(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),n=(4-e.length%4)%4,l=e+"=".repeat(n),o=atob(l),p=new Uint8Array(o.length);for(let b=0;b<o.length;b++)p[b]=o.charCodeAt(b);return p.buffer}function H(t){return{...t,challenge:M(t.challenge),user:{...t.user,id:M(t.user.id)},excludeCredentials:t.excludeCredentials?.map(e=>({...e,id:M(e.id)}))}}function J(t){return{...t,challenge:M(t.challenge),allowCredentials:t.allowCredentials?.map(e=>({...e,id:M(e.id)}))}}function A(t){return{id:t.id,rawId:_(t.rawId),type:t.type,response:{clientDataJSON:_(t.response.clientDataJSON),attestationObject:t.response.attestationObject?_(t.response.attestationObject):void 0,authenticatorData:t.response.authenticatorData?_(t.response.authenticatorData):void 0,signature:t.response.signature?_(t.response.signature):void 0,userHandle:t.response.userHandle?_(t.response.userHandle):void 0}}}async function W(t){if(!S())throw new Error("Passkeys nie są obsługiwane w tej przeglądarce");try{const e=H(t),n=await navigator.credentials.create({publicKey:e});if(!n)throw new Error("Nie udało się utworzyć passkey");return A(n)}catch(e){throw console.error("Passkey registration failed:",e),e.name==="NotAllowedError"?new Error("Rejestracja passkey została anulowana lub upłynął limit czasu"):e.name==="InvalidStateError"?new Error("Ten passkey jest już zarejestrowany"):new Error("Nie udało się zarejestrować passkey: "+e.message)}}async function N(t,e=!1,n=null){if(!S())throw new Error("Passkeys nie są obsługiwane w tej przeglądarce");try{const o={publicKey:J(t)};e&&(o.mediation="conditional"),n&&(o.signal=n);const p=await navigator.credentials.get(o);if(!p)throw new Error("Nie udało się pobrać passkey");return A(p)}catch(l){throw l.name==="AbortError"?new Error("Uwierzytelnianie passkey zostało przerwane"):l.name==="NotAllowedError"?new Error("Uwierzytelnianie passkey zostało anulowane lub upłynął limit czasu"):new Error("Nie udało się uwierzytelnić za pomocą passkey: "+l.message)}}function De(){const t=v(!1),e=v(null),n=v([]),l=async()=>{const d=S(),i=await V();return{supported:d,platformAvailable:i}},o=async()=>{t.value=!0,e.value=null;try{const d=await w.get("/auth/passkeys");return n.value=d.data,d.data}catch(d){throw e.value=d.response?.data?.error||"Nie udało się pobrać listy passkeys",d}finally{t.value=!1}};return{loading:t,error:e,passkeys:n,checkSupport:l,listPasskeys:o,register:async(d="My Passkey")=>{t.value=!0,e.value=null;try{const h=(await w.post("/auth/passkey/register/begin")).data.publicKey,g=await W(h);return await w.post("/auth/passkey/register/finish",{name:d,credential:g}),await o(),!0}catch(i){throw e.value=i.message||i.response?.data?.error||"Nie udało się zarejestrować passkey",i}finally{t.value=!1}},login:async(d="",i=!1,h=null)=>{t.value=!0,e.value=null;try{const s=(await w.post("/auth/passkey/login/begin",{email:d||""})).data.publicKey,a=await N(s,i,h);return(await w.post("/auth/passkey/login/finish",{email:d||"",credential:a})).data}catch(g){throw e.value=g.message||g.response?.data?.error||"Nie udało się zalogować za pomocą passkey",g}finally{t.value=!1}},loginWithConditionalUI:async(d=null,i=!0)=>{t.value=!0,e.value=null;try{const g=(await w.post("/auth/passkey/login/begin",{email:""})).data.publicKey,s=await N(g,i,d);return(await w.post("/auth/passkey/login/finish",{email:"",credential:s})).data}catch(h){throw e.value=h.message||h.response?.data?.error||"Nie udało się zalogować za pomocą passkey",h}finally{t.value=!1}},deletePasskey:async d=>{t.value=!0,e.value=null;try{return await w.delete("/auth/passkeys",{data:{credentialId:d}}),await o(),!0}catch(i){throw e.value=i.response?.data?.error||"Nie udało się usunąć passkey",i}finally{t.value=!1}}}}function Ne(){const{locale:t}=F(),e=$(()=>P.find(o=>o.code===t.value)||P[0]),n=P;function l(o){I(o)}return{locale:t,currentLocale:e,locales:n,changeLocale:l}}const q=L("migration",()=>{const t=v(!1),e=v(!1),n=v(null),l=v(!1),o=v(null),p=v(null);async function b(){try{const i=await w.get("/migrate/status");return t.value=i.data.migrationEnabled,e.value=i.data.hasExistingData,n.value=i.data.lastMigration,i.data}catch(i){return i.response?.status===404?(t.value=!1,{migrationEnabled:!1}):(console.warn("Failed to check migration status:",i),t.value=!1,{migrationEnabled:!1})}}async function E(i,h=!1){l.value=!0,p.value=null,o.value=null;try{const g=h?"/migrate/import?overwrite=true":"/migrate/import",s=await w.post(g,i,{headers:{"Content-Type":"application/json"}});return o.value=s.data.result,e.value=!0,s.data.result?.completedAt&&(n.value=s.data.result.completedAt),s.data}catch(g){const s=g.response?.data?.error||g.message||"Migration failed";throw p.value=s,g.response?.data?.result&&(o.value=g.response.data.result),new Error(s)}finally{l.value=!1}}async function C(i,h=!1){return new Promise((g,s)=>{const a=new FileReader;a.onload=async y=>{try{const k=JSON.parse(y.target.result),B=await E(k,h);g(B)}catch(k){k instanceof SyntaxError?(p.value="Invalid JSON file",s(new Error("Invalid JSON file"))):s(k)}},a.onerror=()=>{p.value="Failed to read file",s(new Error("Failed to read file"))},a.readAsText(i)})}function d(){o.value=null,p.value=null}return{migrationEnabled:t,hasExistingData:e,lastMigration:n,migrationInProgress:l,migrationResult:o,migrationError:p,checkMigrationStatus:b,importBackup:E,importFromFile:C,clearState:d}}),G={key:0,class:"bg-gray-800/50 rounded-xl p-6 border border-gray-700"},Q={class:"flex items-center gap-3 mb-4"},X={class:"text-lg font-semibold text-white"},Y={class:"text-sm text-gray-400"},Z={key:0,class:"mb-4 p-4 bg-amber-900/30 border border-amber-600/50 rounded-lg"},ee={class:"flex items-start gap-3"},te={class:"text-amber-200 text-sm font-medium"},re={class:"flex items-center gap-2 mt-2 cursor-pointer"},se={class:"text-sm text-gray-300"},ae={key:1,class:"mb-4 p-3 bg-green-900/20 border border-green-600/30 rounded-lg"},ne={class:"text-green-300 text-sm"},oe=["disabled"],ie={key:0},le={class:"text-gray-400 mb-2"},ue={key:1},de={class:"flex items-center justify-center gap-3 mb-4"},ce={class:"text-left"},pe={class:"text-white font-medium"},ge={class:"text-gray-400 text-sm"},me={key:2,class:"py-4"},fe={class:"text-purple-300"},he=["disabled"],ve={key:3,class:"mt-4"},ye={class:"flex items-center gap-2 mb-2"},we={key:0,class:"w-5 h-5 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},be={key:1,class:"w-5 h-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ke={key:0,class:"mt-3"},xe={class:"text-sm text-gray-400 mb-2"},_e={class:"grid grid-cols-2 sm:grid-cols-3 gap-2 text-sm"},Ee={class:"text-gray-400"},Me={class:"text-white ml-1"},Ce={key:1,class:"mt-3"},Se={class:"text-sm text-red-400 mb-1"},Pe={class:"text-sm text-gray-400 list-disc list-inside max-h-32 overflow-y-auto"},ze={key:4,class:"mt-4 p-4 bg-red-900/30 border border-red-600/50 rounded-lg"},Re={class:"text-red-300 text-sm"},Ae={__name:"MigrationPanel",setup(t){const e=q(),n=v(null),l=v(!1),o=v(!1),p=v(null);O(()=>{e.checkMigrationStatus()});function b(s){l.value=!1;const a=s.dataTransfer.files;a.length>0&&a[0].name.endsWith(".json")&&(n.value=a[0],e.clearState())}function E(s){const a=s.target.files;a.length>0&&(n.value=a[0],e.clearState())}function C(){n.value=null,p.value&&(p.value.value=""),e.clearState()}async function d(){if(n.value)try{const s=e.hasExistingData&&o.value;await e.importFromFile(n.value,s)}catch(s){console.error("Migration failed:",s)}}function i(){n.value=null,o.value=!1,p.value&&(p.value.value=""),e.clearState(),e.checkMigrationStatus()}function h(s){return s<1024?s+" B":s<1024*1024?(s/1024).toFixed(1)+" KB":(s/(1024*1024)).toFixed(1)+" MB"}function g(s){return new Date(s).toLocaleString()}return(s,a)=>u(e).migrationEnabled?(f(),m("div",G,[r("div",Q,[a[4]||(a[4]=r("div",{class:"p-2 bg-purple-600/20 rounded-lg"},[r("svg",{class:"w-6 h-6 text-purple-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 7v10c0 2 1 3 3 3h10c2 0 3-1 3-3V7c0-2-1-3-3-3H7c-2 0-3 1-3 3zm0 5h16M8 3v4m8-4v4"})])],-1)),r("div",null,[r("h3",X,c(s.$t("migration.title")),1),r("p",Y,c(s.$t("migration.description")),1)])]),u(e).hasExistingData&&!o.value?(f(),m("div",Z,[r("div",ee,[a[5]||(a[5]=r("svg",{class:"w-5 h-5 text-amber-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),r("div",null,[r("p",te,c(s.$t("migration.existingDataWarning")),1),r("label",re,[U(r("input",{type:"checkbox","onUpdate:modelValue":a[0]||(a[0]=y=>o.value=y),class:"w-4 h-4 rounded border-gray-600 bg-gray-700 text-purple-500 focus:ring-purple-500"},null,512),[[K,o.value]]),r("span",se,c(s.$t("migration.confirmOverwrite")),1)])])])])):x("",!0),u(e).lastMigration?(f(),m("div",ae,[r("p",ne,c(s.$t("migration.lastMigration"))+": "+c(g(u(e).lastMigration)),1)])):x("",!0),r("div",{class:R(["border-2 border-dashed rounded-lg p-6 text-center transition-colors",[l.value?"border-purple-500 bg-purple-900/20":"border-gray-600 hover:border-gray-500",u(e).migrationInProgress?"opacity-50 pointer-events-none":""]]),onDragover:a[2]||(a[2]=z(y=>l.value=!0,["prevent"])),onDragleave:a[3]||(a[3]=z(y=>l.value=!1,["prevent"])),onDrop:z(b,["prevent"])},[r("input",{type:"file",ref_key:"fileInput",ref:p,accept:".json",class:"hidden",onChange:E,disabled:u(e).migrationInProgress},null,40,oe),!n.value&&!u(e).migrationInProgress?(f(),m("div",ie,[a[6]||(a[6]=r("svg",{class:"w-12 h-12 mx-auto text-gray-500 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1)),r("p",le,c(s.$t("migration.dragDropHint")),1),r("button",{onClick:a[1]||(a[1]=y=>s.$refs.fileInput.click()),class:"text-purple-400 hover:text-purple-300 font-medium"},c(s.$t("migration.selectBackupFile")),1)])):n.value&&!u(e).migrationInProgress?(f(),m("div",ue,[r("div",de,[a[8]||(a[8]=r("svg",{class:"w-8 h-8 text-purple-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),r("div",ce,[r("p",pe,c(n.value.name),1),r("p",ge,c(h(n.value.size)),1)]),r("button",{onClick:C,class:"ml-2 p-1 text-gray-400 hover:text-white rounded"},[...a[7]||(a[7]=[r("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])])):(f(),m("div",me,[a[9]||(a[9]=r("div",{class:"animate-spin w-8 h-8 border-4 border-purple-500 border-t-transparent rounded-full mx-auto mb-3"},null,-1)),r("p",fe,c(s.$t("migration.importing")),1)]))],34),n.value&&!u(e).migrationInProgress?(f(),m("button",{key:2,onClick:d,disabled:u(e).hasExistingData&&!o.value,class:"w-full mt-4 py-3 px-4 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-medium rounded-lg transition-colors flex items-center justify-center gap-2"},[a[10]||(a[10]=r("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})],-1)),T(" "+c(s.$t("migration.startMigration")),1)],8,he)):x("",!0),u(e).migrationResult?(f(),m("div",ve,[r("div",{class:R(["p-4 rounded-lg",u(e).migrationResult.success?"bg-green-900/30 border border-green-600/50":"bg-red-900/30 border border-red-600/50"])},[r("div",ye,[u(e).migrationResult.success?(f(),m("svg",we,[...a[11]||(a[11]=[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(f(),m("svg",be,[...a[12]||(a[12]=[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},null,-1)])])),r("span",{class:R([u(e).migrationResult.success?"text-green-300":"text-red-300","font-medium"])},c(u(e).migrationResult.success?s.$t("migration.success"):s.$t("migration.failed")),3)]),u(e).migrationResult.recordsMigrated?(f(),m("div",ke,[r("p",xe,c(s.$t("migration.recordsMigrated"))+":",1),r("div",_e,[(f(!0),m(j,null,D(u(e).migrationResult.recordsMigrated,(y,k)=>(f(),m("div",{key:k,class:"bg-gray-800/50 px-2 py-1 rounded"},[r("span",Ee,c(k)+":",1),r("span",Me,c(y),1)]))),128))])])):x("",!0),u(e).migrationResult.errors?.length?(f(),m("div",Ce,[r("p",Se,c(s.$t("migration.errors"))+":",1),r("ul",Pe,[(f(!0),m(j,null,D(u(e).migrationResult.errors,(y,k)=>(f(),m("li",{key:k},c(y),1))),128))])])):x("",!0)],2),r("button",{onClick:i,class:"mt-3 text-sm text-gray-400 hover:text-white"},c(s.$t("migration.startNew")),1)])):x("",!0),u(e).migrationError&&!u(e).migrationResult?(f(),m("div",ze,[r("p",Re,c(u(e).migrationError),1)])):x("",!0)])):x("",!0)}};export{Ae as _,De as a,Ne as u};
