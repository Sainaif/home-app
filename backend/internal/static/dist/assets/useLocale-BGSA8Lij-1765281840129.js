import{r as h,A as u,i as v,l as z,N as g,O as P}from"./index-Hs7aDjjl-1765281840129.js";function f(){return window.PublicKeyCredential!==void 0&&typeof window.PublicKeyCredential=="function"}async function E(){if(!f())return!1;try{return await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable()}catch(e){return console.error("Error checking platform authenticator:",e),!1}}function p(e){const a=new Uint8Array(e);let s="";for(let n=0;n<a.length;n++)s+=String.fromCharCode(a[n]);return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function d(e){const a=e.replace(/-/g,"+").replace(/_/g,"/"),s=(4-a.length%4)%4,n=a+"=".repeat(s),r=atob(n),c=new Uint8Array(r.length);for(let y=0;y<r.length;y++)c[y]=r.charCodeAt(y);return c.buffer}function A(e){return{...e,challenge:d(e.challenge),user:{...e.user,id:d(e.user.id)},excludeCredentials:e.excludeCredentials?.map(a=>({...a,id:d(a.id)}))}}function C(e){return{...e,challenge:d(e.challenge),allowCredentials:e.allowCredentials?.map(a=>({...a,id:d(a.id)}))}}function m(e){return{id:e.id,rawId:p(e.rawId),type:e.type,response:{clientDataJSON:p(e.response.clientDataJSON),attestationObject:e.response.attestationObject?p(e.response.attestationObject):void 0,authenticatorData:e.response.authenticatorData?p(e.response.authenticatorData):void 0,signature:e.response.signature?p(e.response.signature):void 0,userHandle:e.response.userHandle?p(e.response.userHandle):void 0}}}async function N(e){if(!f())throw new Error("Passkeys nie są obsługiwane w tej przeglądarce");try{const a=A(e),s=await navigator.credentials.create({publicKey:a});if(!s)throw new Error("Nie udało się utworzyć passkey");return m(s)}catch(a){throw console.error("Passkey registration failed:",a),a.name==="NotAllowedError"?new Error("Rejestracja passkey została anulowana lub upłynął limit czasu"):a.name==="InvalidStateError"?new Error("Ten passkey jest już zarejestrowany"):new Error("Nie udało się zarejestrować passkey: "+a.message)}}async function k(e,a=!1,s=null){if(!f())throw new Error("Passkeys nie są obsługiwane w tej przeglądarce");try{const r={publicKey:C(e)};a&&(r.mediation="conditional"),s&&(r.signal=s);const c=await navigator.credentials.get(r);if(!c)throw new Error("Nie udało się pobrać passkey");return m(c)}catch(n){throw n.name==="AbortError"?new Error("Uwierzytelnianie passkey zostało przerwane"):n.name==="NotAllowedError"?new Error("Uwierzytelnianie passkey zostało anulowane lub upłynął limit czasu"):new Error("Nie udało się uwierzytelnić za pomocą passkey: "+n.message)}}function K(){const e=h(!1),a=h(null),s=h([]),n=async()=>{const t=f(),o=await E();return{supported:t,platformAvailable:o}},r=async()=>{e.value=!0,a.value=null;try{const t=await u.get("/auth/passkeys");return s.value=t.data,t.data}catch(t){throw a.value=t.response?.data?.error||"Nie udało się pobrać listy passkeys",t}finally{e.value=!1}};return{loading:e,error:a,passkeys:s,checkSupport:n,listPasskeys:r,register:async(t="My Passkey")=>{e.value=!0,a.value=null;try{const i=(await u.post("/auth/passkey/register/begin")).data.publicKey,l=await N(i);return await u.post("/auth/passkey/register/finish",{name:t,credential:l}),await r(),!0}catch(o){throw a.value=o.message||o.response?.data?.error||"Nie udało się zarejestrować passkey",o}finally{e.value=!1}},login:async(t="",o=!1,i=null)=>{e.value=!0,a.value=null;try{const w=(await u.post("/auth/passkey/login/begin",{email:t||""})).data.publicKey,b=await k(w,o,i);return(await u.post("/auth/passkey/login/finish",{email:t||"",credential:b})).data}catch(l){throw a.value=l.message||l.response?.data?.error||"Nie udało się zalogować za pomocą passkey",l}finally{e.value=!1}},loginWithConditionalUI:async(t=null,o=!0)=>{e.value=!0,a.value=null;try{const l=(await u.post("/auth/passkey/login/begin",{email:""})).data.publicKey,w=await k(l,o,t);return(await u.post("/auth/passkey/login/finish",{email:"",credential:w})).data}catch(i){throw a.value=i.message||i.response?.data?.error||"Nie udało się zalogować za pomocą passkey",i}finally{e.value=!1}},deletePasskey:async t=>{e.value=!0,a.value=null;try{return await u.delete("/auth/passkeys",{data:{credentialId:t}}),await r(),!0}catch(o){throw a.value=o.response?.data?.error||"Nie udało się usunąć passkey",o}finally{e.value=!1}}}}function O(){const{locale:e}=v(),a=z(()=>g.find(r=>r.code===e.value)||g[0]),s=g;function n(r){P(r)}return{locale:e,currentLocale:a,locales:s,changeLocale:n}}export{K as a,O as u};
