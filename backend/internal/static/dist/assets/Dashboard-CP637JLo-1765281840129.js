import{c as L,j as pe,r as w,l as E,z as me,B as ye,o as ge,A as d,a as fe,C as be,b as l,e as t,g as Y,u as n,m as ve,t as o,f as c,R as ee,S as te,n as O,W as se,F as N,h as R,w as H,v as Z,D as _e,d as r,s as B}from"./index-Hs7aDjjl-1765281840129.js";import{u as xe,D as F}from"./useDataEvents-DV5fgDvx-1765281840129.js";import{F as we,Z as ke,a as $e,W as De}from"./zap-CruOimIk-1765281840129.js";import{C as Ce}from"./circle-check-big-DG1FXVDr-1765281840129.js";import{U as Ae}from"./users-4UTmRSxS-1765281840129.js";/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=L("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=L("badge-check",[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=L("clipboard-list",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=L("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]]),Ee={class:"mb-8"},Ne={key:0,class:"mb-4"},Re={class:"text-4xl font-bold gradient-text mb-2"},Be={class:"text-gray-400"},Fe={class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"},Le={class:"flex items-center justify-between"},Ue={class:"text-gray-400 text-sm mb-1"},Se={class:"text-3xl font-bold"},Te={class:"w-12 h-12 rounded-xl bg-purple-600/20 flex items-center justify-center"},Me={class:"flex items-center justify-between"},Ve={class:"text-gray-400 text-sm mb-1"},ze={class:"text-3xl font-bold"},We={class:"w-12 h-12 rounded-xl bg-pink-600/20 flex items-center justify-center"},Ge={class:"flex items-center justify-between"},Oe={class:"text-gray-400 text-sm mb-1"},He={key:0,class:"card mb-6"},Ze={class:"card-header"},qe={class:"card-title"},Xe={class:"text-yellow-400 font-bold"},Je={class:"overflow-x-auto"},Ke={class:"w-full"},Qe={class:"border-b border-gray-700"},Ye={class:"text-left"},et={class:"pb-3"},tt={class:"pb-3"},st={class:"pb-3"},at={class:"pb-3"},ot={class:"py-3"},nt={class:"py-3"},rt={class:"py-3"},lt={class:"py-3 font-bold text-yellow-400"},it={class:"py-3"},ct=["onClick"],dt={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},ut={class:"card"},ht={class:"card-header"},pt={class:"card-title"},mt={key:0,class:"flex justify-center py-8"},yt={key:1,class:"text-center py-8 text-gray-500"},gt={key:2,class:"space-y-3"},ft=["onClick"],bt={class:"flex items-center gap-3"},vt={class:"w-10 h-10 rounded-lg bg-purple-600/20 flex items-center justify-center"},_t={class:"font-medium"},xt={class:"text-xs text-gray-400"},wt={class:"font-bold text-purple-400"},kt={class:"card"},$t={class:"card-header"},Dt={class:"card-title"},Ct={key:0,class:"flex justify-center py-8"},At={key:1,class:"text-center py-8 text-gray-500"},It={key:2,class:"space-y-3"},Pt={class:"flex items-center gap-3"},jt={class:"w-10 h-10 rounded-lg bg-pink-600/20 flex items-center justify-center"},Et={class:"font-medium"},Nt={class:"text-xs text-gray-400"},Rt={class:"text-sm text-gray-400"},Bt={class:"card"},Ft={class:"card-header"},Lt={class:"card-title"},Ut={key:0,class:"flex justify-center py-8"},St={key:1,class:"text-center py-8 text-gray-500"},Tt={key:2,class:"space-y-3"},Mt={class:"flex items-center gap-3"},Vt={class:"w-10 h-10 rounded-lg bg-red-600/20 flex items-center justify-center"},zt={class:"font-medium"},Wt={class:"text-xs text-gray-400"},Gt={class:"font-bold text-red-400"},Kt={__name:"Dashboard",setup(Ot){let y=null;function ae(){return y&&y.abort(),y=new AbortController,y.signal}const g=ve(),p=me(),U=pe(),v=w([]),_=w([]),x=w([]),k=w([]),$=w(!1),C=w(null),A=E(()=>p.params.userId||U.user?.id),{connect:oe,on:S}=ye(),{on:I}=xe(),P=E(()=>{const e=A.value;return x.value.reduce((s,i)=>{const a=parseFloat(i.netAmount.$numberDecimal||i.netAmount||0);return i.fromUserId===e?s-a:i.toUserId===e?s+a:s},0)}),ne=E(()=>{const e=P.value,s=e.toFixed(2);return e>=0?`+${s}`:s}),re=E(()=>k.value.reduce((e,s)=>{const i=parseFloat(s.allocation.amountPLN||0);return e+i},0));ge(async()=>{if(p.params.userId)try{const e=await d.get(`/users/${p.params.userId}`);C.value=e.data}catch(e){console.error("Failed to load user:",e)}await j(),p.params.userId||(oe(),S("bill.created",()=>{console.log("[Dashboard] Bill created, refreshing..."),ie()}),S("chore.updated",()=>{console.log("[Dashboard] Chore updated, refreshing..."),T()}),S("payment.created",()=>{console.log("[Dashboard] Payment created, refreshing..."),ce()})),I(F.USER_UPDATED,()=>j()),I(F.GROUP_UPDATED,()=>j()),I(F.CHORE_CREATED,()=>T()),I(F.CHORE_ASSIGNMENT_UPDATED,()=>T())}),fe(()=>{y&&(y.abort(),y=null)}),be(A,()=>{j()});async function j(){$.value=!0;const e=ae();try{const s=A.value,i=p.params.userId,[a,f]=await Promise.all([d.get("/chores",{signal:e}),d.get("/users",{signal:e})]),Q=a.data||[],V=f.data||[],[z,W,h]=await Promise.all([d.get("/bills",{signal:e}),i?d.get(`/chore-assignments?userId=${s}&status=pending`,{signal:e}):d.get("/chore-assignments/me?status=pending",{signal:e}),i?d.get(`/loans/balances/user/${s}`,{signal:e}):d.get("/loans/balances/me",{signal:e})]);v.value=z.data||[];const m=W.data||[];for(let D of m){const G=Q.find(u=>u.id===D.choreId);G&&(D.choreName=G.name);const b=V.find(u=>u.id===D.assigneeUserId);b&&(D.userName=b.name)}_.value=m,x.value=Array.isArray(h.data)?h.data:h.data?.balances||[],await le(e)}catch(s){if(s.name==="AbortError"||s.name==="CanceledError")return;console.error("Failed to load dashboard data:",s),v.value=[],_.value=[],x.value=[]}finally{$.value=!1}}async function le(e){try{const s=A.value;let i=U.user?.groupId;p.params.userId&&C.value&&(i=C.value.groupId);const f=(await d.get("/bills?status=posted",{signal:e})).data||[],V=(await d.get("/payments/me",{signal:e})).data||[],z=f.map(async h=>{try{if(V.some(u=>u.billId===h.id))return null;const b=((await d.get(`/bills/${h.id}/allocation`,{signal:e})).data||[]).find(u=>!!(u.subjectType==="user"&&u.subjectId===s||u.subjectType==="group"&&i&&u.subjectId===i));if(b)return{bill:h,allocation:{id:b.subjectId,amountPLN:b.amount||0,units:b.units||0}}}catch(m){if(m.name==="AbortError"||m.name==="CanceledError")throw m;console.error(`Failed to load allocations for bill ${h.id}:`,m)}return null}),W=await Promise.all(z);k.value=W.filter(h=>h!==null)}catch(s){if(s.name==="AbortError"||s.name==="CanceledError")return;console.error("Failed to load pending allocations:",s),k.value=[]}}async function ie(){try{const e=await d.get("/bills");v.value=e.data||[]}catch(e){console.error("Failed to load bills:",e)}}async function T(){try{const e=await d.get("/chore-assignments/me?status=pending");_.value=e.data||[]}catch(e){console.error("Failed to load chores:",e)}}async function ce(){try{const e=await d.get("/loans/balances/me");x.value=Array.isArray(e.data)?e.data:e.data?.balances||[]}catch(e){console.error("Failed to load balances:",e)}}function M(e){return parseFloat(e.$numberDecimal||e||0).toFixed(2)}function de(e){return new Date(e).toLocaleDateString("pl-PL",{day:"numeric",month:"short"})}function X(e,s){const i=new Date(e).toLocaleDateString("pl-PL",{day:"numeric",month:"short"}),a=new Date(s).toLocaleDateString("pl-PL",{day:"numeric",month:"short"});return`${i} - ${a}`}function ue(e){return parseFloat(e.$numberDecimal||e||0).toFixed(3)}function J(e){return e.type==="electricity"?"Prąd":e.type==="gas"?"Gaz":e.type==="internet"?"Internet":e.type==="inne"&&e.customType?e.customType:e.type}function he(e){return e==="electricity"?"kWh":e==="gas"?"m³":"jednostek"}function K(e){g.push(`/bills/${e}`)}return(e,s)=>{const i=_e("router-link");return r(),l("div",null,[t("div",Ee,[n(p).params.userId?(r(),l("div",Ne,[t("button",{onClick:s[0]||(s[0]=a=>n(g).push("/")),class:"btn btn-secondary"},"← "+o(e.$t("dashboard.backButton")),1)])):Y("",!0),t("h1",Re,o(n(p).params.userId?`${e.$t("dashboard.title")}: ${C.value?.name||e.$t("common.loading")}`:e.$t("dashboard.welcome",{name:n(U).user?.name})),1),t("p",Be,o(e.$t("dashboard.overview")),1)]),t("div",Fe,[t("div",{class:"stat-card cursor-pointer hover:scale-105 transition-transform",onClick:s[1]||(s[1]=a=>n(g).push("/bills"))},[t("div",Le,[t("div",null,[t("p",Ue,o(e.$t("dashboard.billsThisMonth")),1),t("p",Se,o(v.value.length),1)]),t("div",Te,[c(n(ee),{class:"w-6 h-6 text-purple-400"})])])]),t("div",{class:"stat-card cursor-pointer hover:scale-105 transition-transform",onClick:s[2]||(s[2]=a=>n(g).push("/chores"))},[t("div",Me,[t("div",null,[t("p",Ve,o(e.$t("dashboard.pendingChores")),1),t("p",ze,o(_.value.length),1)]),t("div",We,[c(n(te),{class:"w-6 h-6 text-pink-400"})])])]),t("div",{class:"stat-card cursor-pointer hover:scale-105 transition-transform",onClick:s[3]||(s[3]=a=>n(g).push("/balance"))},[t("div",Ge,[t("div",null,[t("p",Oe,o(e.$t("dashboard.yourBalance")),1),t("p",{class:O(["text-3xl font-bold",P.value<0?"text-red-400":"text-green-400"])},o(ne.value)+" PLN",3)]),t("div",{class:O(["w-12 h-12 rounded-xl",P.value<0?"bg-red-600/20":"bg-green-600/20"])},[c(n(se),{class:O(["w-6 h-6",P.value<0?"text-red-400":"text-green-400"])},null,8,["class"])],2)])])]),k.value.length>0?(r(),l("div",He,[t("div",Ze,[t("h2",qe,o(e.$t("dashboard.pendingBills")),1),t("div",Xe,o(re.value.toFixed(2))+" PLN",1)]),t("div",Je,[t("table",Ke,[t("thead",Qe,[t("tr",Ye,[t("th",et,o(e.$t("dashboard.bill")),1),t("th",tt,o(e.$t("dashboard.period")),1),t("th",st,o(e.$t("dashboard.yourConsumption")),1),t("th",at,o(e.$t("dashboard.amountDue")),1),s[6]||(s[6]=t("th",{class:"pb-3"},null,-1))])]),t("tbody",null,[(r(!0),l(N,null,R(k.value,a=>(r(),l("tr",{key:a.allocation.id,class:"border-b border-gray-700"},[t("td",ot,o(J(a.bill)),1),t("td",nt,o(X(a.bill.periodStart,a.bill.periodEnd)),1),t("td",rt,o(ue(a.allocation.units))+" "+o(he(a.bill.type)),1),t("td",lt,o(M(a.allocation.amountPLN))+" PLN",1),t("td",it,[t("button",{onClick:f=>K(a.bill.id),class:"text-blue-400 hover:text-blue-300 text-sm"},o(e.$t("dashboard.details"))+" → ",9,ct)])]))),128))])])])])):Y("",!0),t("div",dt,[t("div",ut,[t("div",ht,[t("h2",pt,o(e.$t("dashboard.recentBills")),1),c(n(ee),{class:"w-5 h-5 text-purple-400"})]),$.value?(r(),l("div",mt,[...s[7]||(s[7]=[t("div",{class:"loading-spinner"},null,-1)])])):v.value.length===0?(r(),l("div",yt,[c(n(we),{class:"w-12 h-12 mx-auto mb-2 opacity-50"}),t("p",null,o(e.$t("dashboard.noBills")),1)])):(r(),l("div",gt,[(r(!0),l(N,null,R(v.value.slice(0,5),a=>(r(),l("div",{key:a.id,onClick:f=>K(a.id),class:"flex items-center justify-between p-3 rounded-xl bg-gray-700/30 hover:bg-gray-700/50 transition-colors cursor-pointer"},[t("div",bt,[t("div",vt,[a.type==="electricity"?(r(),B(n(ke),{key:0,class:"w-5 h-5 text-yellow-400"})):a.type==="gas"?(r(),B(n($e),{key:1,class:"w-5 h-5 text-orange-400"})):a.type==="internet"?(r(),B(n(De),{key:2,class:"w-5 h-5 text-blue-400"})):(r(),B(n(Ae),{key:3,class:"w-5 h-5 text-gray-400"}))]),t("div",null,[t("p",_t,o(J(a)),1),t("p",xt,o(X(a.periodStart,a.periodEnd)),1)])]),t("span",wt,o(M(a.totalAmountPLN))+" PLN",1)],8,ft))),128))])),c(i,{to:"/bills",class:"btn btn-outline w-full mt-4 flex items-center justify-center gap-2"},{default:H(()=>[Z(o(e.$t("common.viewAll"))+" ",1),c(n(q),{class:"w-4 h-4"})]),_:1})]),t("div",kt,[t("div",$t,[t("h2",Dt,o(e.$t("dashboard.upcomingChores")),1),c(n(te),{class:"w-5 h-5 text-pink-400"})]),$.value?(r(),l("div",Ct,[...s[8]||(s[8]=[t("div",{class:"loading-spinner"},null,-1)])])):_.value.length===0?(r(),l("div",At,[c(n(Ce),{class:"w-12 h-12 mx-auto mb-2 opacity-50"}),t("p",null,o(e.$t("dashboard.noChores")),1)])):(r(),l("div",It,[(r(!0),l(N,null,R(_.value.slice(0,5),a=>(r(),l("div",{key:a.id,onClick:s[4]||(s[4]=f=>n(g).push("/chores")),class:"flex items-center justify-between p-3 rounded-xl bg-gray-700/30 hover:bg-gray-700/50 transition-colors cursor-pointer"},[t("div",Pt,[t("div",jt,[c(n(Pe),{class:"w-5 h-5 text-pink-400"})]),t("div",null,[t("p",Et,o(a.choreName),1),t("p",Nt,o(a.userName),1)])]),t("span",Rt,o(de(a.dueDate)),1)]))),128))])),c(i,{to:"/chores",class:"btn btn-outline w-full mt-4 flex items-center justify-center gap-2"},{default:H(()=>[Z(o(e.$t("common.viewAll"))+" ",1),c(n(q),{class:"w-4 h-4"})]),_:1})]),t("div",Bt,[t("div",Ft,[t("h2",Lt,o(e.$t("dashboard.currentBalance")),1),c(n(se),{class:"w-5 h-5 text-green-400"})]),$.value?(r(),l("div",Ut,[...s[9]||(s[9]=[t("div",{class:"loading-spinner"},null,-1)])])):x.value.length===0?(r(),l("div",St,[c(n(Ie),{class:"w-12 h-12 mx-auto mb-2 opacity-50"}),t("p",null,o(e.$t("dashboard.noDebts")),1)])):(r(),l("div",Tt,[(r(!0),l(N,null,R(x.value.slice(0,5),a=>(r(),l("div",{key:`${a.fromUserId}-${a.toUserId}`,onClick:s[5]||(s[5]=f=>n(g).push("/balance")),class:"flex items-center justify-between p-3 rounded-xl bg-gray-700/30 hover:bg-gray-700/50 transition-colors cursor-pointer"},[t("div",Mt,[t("div",Vt,[c(n(je),{class:"w-5 h-5 text-red-400"})]),t("div",null,[t("p",zt,o(a.fromUserName),1),t("p",Wt,o(e.$t("common.for"))+" "+o(a.toUserName),1)])]),t("span",Gt,o(M(a.netAmount))+" PLN",1)]))),128))])),c(i,{to:"/balance",class:"btn btn-outline w-full mt-4 flex items-center justify-center gap-2"},{default:H(()=>[Z(o(e.$t("common.viewDetails"))+" ",1),c(n(q),{class:"w-4 h-4"})]),_:1})])])])}}};export{Kt as default};
