import{i as Y,j as Z,r as i,l as ee,o as te,A as h,b as l,e as t,g as u,t as s,u as y,v as se,F as M,h as S,q as d,y as U,E as m,J as oe,p as ae,d as r,n as B}from"./index-Hs7aDjjl-1765281840129.js";import{u as ne,D as F}from"./useDataEvents-DV5fgDvx-1765281840129.js";const le={class:"page-header"},re={class:"text-3xl font-bold"},ie={class:"button-group"},de={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},ue={class:"stat-card"},ce={class:"text-gray-400 text-sm mb-1"},he={class:"text-3xl font-bold text-purple-400"},pe={class:"stat-card"},ve={class:"text-gray-400 text-sm mb-1"},me={class:"text-3xl font-bold text-green-400"},ye={class:"stat-card"},_e={class:"text-gray-400 text-sm mb-1"},be={class:"text-3xl font-bold text-yellow-400"},fe={class:"stat-card"},ge={class:"text-gray-400 text-sm mb-1"},$e={class:"text-3xl font-bold text-blue-400"},ke={key:0,class:"card mb-6"},we={class:"text-xl font-semibold mb-4 flex items-center gap-2"},De={key:0,class:"text-center py-8"},Ce={key:1,class:"overflow-x-auto"},Ie={class:"w-full"},Ee={class:"border-b border-gray-700"},Me={class:"text-left"},Se={class:"pb-3"},Ue={class:"pb-3"},qe={class:"pb-3"},xe={class:"pb-3"},Ve={class:"pb-3"},Ae={class:"pb-3"},Le={class:"py-3"},Pe={key:0,class:"text-2xl"},Fe={key:1,class:"text-2xl"},Te={key:2,class:"text-2xl"},He={key:3,class:"text-gray-400"},Ne={class:"py-3 font-medium"},Oe={class:"py-3 text-purple-400 font-bold"},Re={class:"py-3 text-green-400"},Be={class:"py-3"},je={class:"py-3 text-yellow-400"},ze={key:1,class:"card mb-6"},Ge={class:"text-xl font-semibold mb-4"},Je={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ke={class:"block text-sm font-medium mb-2"},Qe={class:"block text-sm font-medium mb-2"},We={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Xe={class:"block text-sm font-medium mb-2"},Ye={value:"daily"},Ze={value:"weekly"},et={value:"monthly"},tt={value:"custom"},st={value:"irregular"},ot={key:0},at={class:"block text-sm font-medium mb-2"},nt={class:"block text-sm font-medium mb-2"},lt={value:1},rt={value:2},it={value:3},dt={value:4},ut={value:5},ct={class:"block text-sm font-medium mb-2"},ht={value:1},pt={value:2},vt={value:3},mt={value:4},yt={value:5},_t={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},bt={class:"block text-sm font-medium mb-2"},ft={value:"auto"},gt={value:"manual"},$t={value:"round_robin"},kt={value:"random"},wt={key:0},Dt={class:"block text-sm font-medium mb-2"},Ct={value:""},It=["value"],Et={key:1},Mt={class:"block text-sm font-medium mb-2"},St={class:"flex items-center gap-2"},Ut={for:"notifications",class:"text-sm"},qt=["disabled"],xt={class:"card mb-6"},Vt={class:"flex flex-wrap gap-4"},At={class:"block text-sm font-medium mb-2"},Lt={value:""},Pt={value:"pending"},Ft={value:"in_progress"},Tt={value:"done"},Ht={value:"overdue"},Nt={key:0},Ot={class:"block text-sm font-medium mb-2"},Rt={value:""},Bt=["value"],jt={class:"block text-sm font-medium mb-2"},zt={value:"dueDate"},Gt={value:"priority"},Jt={value:"difficulty"},Kt={value:"points"},Qt={class:"card"},Wt={key:0,class:"text-center py-8"},Xt={key:1,class:"text-center py-8 text-gray-400"},Yt={key:2,class:"space-y-4"},Zt={class:"flex justify-between items-start"},es={class:"flex-1"},ts={class:"flex items-center gap-2 mb-2"},ss={class:"text-lg font-semibold"},os={key:0,class:"text-sm"},as={key:1,class:"px-2 py-1 text-xs rounded bg-red-600/20 text-red-400"},ns={key:0,class:"text-sm text-gray-400 mb-2"},ls={class:"flex flex-wrap gap-4 text-sm"},rs={class:"text-gray-400"},is={class:"text-gray-400"},ds={class:"text-purple-400 font-bold"},us={key:0,class:"text-green-400"},cs={class:"flex gap-2"},hs=["onClick"],ps=["onClick"],vs=["onClick","disabled"],bs={__name:"Chores",setup(ms){const{t:_,locale:j}=Y(),v=Z(),{emit:q}=ne(),b=i([]),T=i([]),w=i([]),$=i([]),f=i(null),x=i(!1),V=i(!1),D=i(!1),C=i(null),I=i(!1),k=i(!1),n=i({name:"",description:"",frequency:"weekly",customInterval:null,difficulty:3,priority:3,assignmentMode:"auto",manualAssigneeId:"",notificationsEnabled:!0,reminderHours:24}),c=i({status:"",userId:"",sortBy:"dueDate"}),A=ee(()=>{if(!b.value)return[];let e=[...b.value];switch(c.value.sortBy){case"priority":e.sort((a,o)=>(o.chore?.priority||0)-(a.chore?.priority||0));break;case"difficulty":e.sort((a,o)=>(o.chore?.difficulty||0)-(a.chore?.difficulty||0));break;case"points":e.sort((a,o)=>(o.points||0)-(a.points||0));break;case"dueDate":default:e.sort((a,o)=>new Date(a.dueDate)-new Date(o.dueDate));break}return e});te(async()=>{await Promise.all([L(),H(),z()]),await g(),f.value=$.value.find(e=>e.userId===v.user?.id)});async function g(){x.value=!0;try{let e="/chore-assignments";const a=[];c.value.status&&a.push(`status=${c.value.status}`),c.value.userId&&a.push(`userId=${c.value.userId}`),a.length>0&&(e+="?"+a.join("&"));const p=(await h.get(e)).data||[];for(let E of p){const O=T.value.find(P=>P.id===E.choreId);O&&(E.chore=O);const R=w.value.find(P=>P.id===E.assigneeUserId);R&&(E.userName=R.name)}b.value=p}catch(e){console.error("Failed to load chore assignments:",e),b.value=[]}finally{x.value=!1}}async function L(){try{const e=await h.get("/chores");T.value=e.data||[]}catch(e){console.error("Failed to load chores:",e)}}async function z(){try{const e=await h.get("/users");w.value=e.data||[]}catch(e){console.error("Failed to load users:",e)}}async function H(){V.value=!0;try{const e=await h.get("/chores/leaderboard");$.value=e.data||[]}catch(e){console.error("Failed to load leaderboard:",e),$.value=[]}finally{V.value=!1}}async function G(){D.value=!0;try{const e=await h.post("/chores",{name:n.value.name,description:n.value.description||void 0,frequency:n.value.frequency,customInterval:n.value.customInterval||void 0,difficulty:n.value.difficulty,priority:n.value.priority,assignmentMode:n.value.assignmentMode,notificationsEnabled:n.value.notificationsEnabled,reminderHours:n.value.reminderHours||void 0});let a=new Date;switch(n.value.frequency){case"daily":a.setDate(a.getDate()+1);break;case"weekly":a.setDate(a.getDate()+7);break;case"monthly":a.setMonth(a.getMonth()+1);break;case"custom":a.setDate(a.getDate()+(n.value.customInterval||7));break;default:a.setDate(a.getDate()+7)}n.value.assignmentMode==="manual"&&n.value.manualAssigneeId?await h.post("/chore-assignments",{choreId:e.data.id,assigneeUserId:n.value.manualAssigneeId,dueDate:a.toISOString()}):n.value.assignmentMode==="auto"?await h.post(`/chores/${e.data.id}/auto-assign`,{dueDate:a.toISOString()}):n.value.assignmentMode==="round_robin"?await h.post(`/chores/${e.data.id}/rotate`,{dueDate:a.toISOString()}):n.value.assignmentMode==="random"&&await h.post(`/chores/${e.data.id}/auto-assign`,{dueDate:a.toISOString()}),n.value={name:"",description:"",frequency:"weekly",customInterval:null,difficulty:3,priority:3,assignmentMode:"auto",manualAssigneeId:"",notificationsEnabled:!0,reminderHours:24},k.value=!1,await L(),await g(),q(F.CHORE_CREATED)}catch(e){console.error("Failed to create chore:",e),alert(_("chores.createError")+" "+(e.response?.data?.error||e.message))}finally{D.value=!1}}async function N(e,a){try{await h.patch(`/chore-assignments/${e}`,{status:a}),await Promise.all([g(),H()]),f.value=$.value.find(o=>o.userId===v.user?.id),q(F.CHORE_ASSIGNMENT_UPDATED,{assignmentId:e})}catch(o){console.error("Failed to update chore status:",o),alert(_("chores.updateStatusError")+" "+(o.response?.data?.error||o.message))}}async function J(e){if(e&&confirm(_("chores.confirmDelete"))){C.value=e;try{(await h.delete(`/chores/${e}`)).data?.requiresApproval?alert(_("chores.deletionRequested")):(await L(),await g(),q(F.CHORE_DELETED,{choreId:e}))}catch(a){console.error("Failed to delete chore:",a),alert(_("chores.deleteError")+" "+(a.response?.data?.error||a.message))}finally{C.value=null}}}function K(){b.value=[...b.value]}function Q(e){const o={pl:"pl-PL",en:"en-US"}[j.value]||"en-US";return new Date(e).toLocaleDateString(o,{day:"numeric",month:"short",year:"numeric"})}function W(e){const a={pending:"chores.pending",in_progress:"chores.inProgress",done:"chores.done",overdue:"chores.overdue"};return a[e]?_(a[e]):e}function X(e){return{pending:"text-yellow-400",in_progress:"text-blue-400",done:"text-green-400",overdue:"text-red-400"}[e]||"text-gray-400"}return(e,a)=>(r(),l("div",null,[t("div",le,[t("h1",re,s(e.$t("chores.title")),1),t("div",ie,[t("button",{onClick:a[0]||(a[0]=o=>I.value=!I.value),class:"btn btn-outline"},s(I.value?e.$t("chores.hideLeaderboard"):e.$t("chores.showLeaderboard")),1),y(v).hasPermission("chores.create")?(r(),l("button",{key:0,onClick:a[1]||(a[1]=o=>k.value=!k.value),class:"btn btn-primary"},s(k.value?e.$t("common.cancel"):"+ "+e.$t("chores.addChore")),1)):u("",!0)])]),t("div",de,[t("div",ue,[t("div",ce,s(e.$t("chores.yourPoints")),1),t("div",he,s(f.value?.totalPoints||0),1)]),t("div",pe,[t("div",ve,s(e.$t("chores.completed")),1),t("div",me,s(f.value?.completedChores||0),1)]),t("div",ye,[t("div",_e,s(e.$t("chores.pending")),1),t("div",be,s(f.value?.pendingChores||0),1)]),t("div",fe,[t("div",ge,s(e.$t("chores.punctuality")),1),t("div",$e,s(f.value?.onTimeRate?.toFixed(0)||0)+"%",1)])]),I.value?(r(),l("div",ke,[t("h2",we,[a[15]||(a[15]=t("span",null,"ðŸ†",-1)),se(" "+s(e.$t("chores.leaderboard")),1)]),V.value?(r(),l("div",De,s(e.$t("common.loading")),1)):(r(),l("div",Ce,[t("table",Ie,[t("thead",Ee,[t("tr",Me,[t("th",Se,s(e.$t("chores.rank")),1),t("th",Ue,s(e.$t("common.user")),1),t("th",qe,s(e.$t("chores.points")),1),t("th",xe,s(e.$t("chores.completed")),1),t("th",Ve,s(e.$t("chores.punctuality")),1),t("th",Ae,s(e.$t("chores.pending")),1)])]),t("tbody",null,[(r(!0),l(M,null,S($.value,(o,p)=>(r(),l("tr",{key:o.userId,class:B([o.userId===y(v).user?.id?"bg-purple-600/20":"","border-b border-gray-700"])},[t("td",Le,[p===0?(r(),l("span",Pe,"ðŸ¥‡")):p===1?(r(),l("span",Fe,"ðŸ¥ˆ")):p===2?(r(),l("span",Te,"ðŸ¥‰")):(r(),l("span",He,"#"+s(p+1),1))]),t("td",Ne,s(o.userName),1),t("td",Oe,s(o.totalPoints),1),t("td",Re,s(o.completedChores),1),t("td",Be,s(o.onTimeRate.toFixed(0))+"%",1),t("td",je,s(o.pendingChores),1)],2))),128))])])]))])):u("",!0),k.value&&y(v).hasPermission("chores.create")?(r(),l("div",ze,[t("h2",Ge,s(e.$t("chores.addNew")),1),t("form",{onSubmit:ae(G,["prevent"]),class:"space-y-4"},[t("div",Je,[t("div",null,[t("label",Ke,s(e.$t("chores.name")),1),d(t("input",{"onUpdate:modelValue":a[2]||(a[2]=o=>n.value.name=o),required:"",class:"input"},null,512),[[U,n.value.name]])]),t("div",null,[t("label",Qe,s(e.$t("chores.descriptionOptional")),1),d(t("input",{"onUpdate:modelValue":a[3]||(a[3]=o=>n.value.description=o),class:"input"},null,512),[[U,n.value.description]])])]),t("div",We,[t("div",null,[t("label",Xe,s(e.$t("chores.frequency")),1),d(t("select",{"onUpdate:modelValue":a[4]||(a[4]=o=>n.value.frequency=o),required:"",class:"input"},[t("option",Ye,s(e.$t("chores.daily")),1),t("option",Ze,s(e.$t("chores.weekly")),1),t("option",et,s(e.$t("chores.monthly")),1),t("option",tt,s(e.$t("chores.custom")),1),t("option",st,s(e.$t("chores.irregular")),1)],512),[[m,n.value.frequency]])]),n.value.frequency==="custom"?(r(),l("div",ot,[t("label",at,s(e.$t("chores.interval")),1),d(t("input",{"onUpdate:modelValue":a[5]||(a[5]=o=>n.value.customInterval=o),type:"number",min:"1",class:"input"},null,512),[[U,n.value.customInterval,void 0,{number:!0}]])])):u("",!0),t("div",null,[t("label",nt,s(e.$t("chores.difficulty")),1),d(t("select",{"onUpdate:modelValue":a[6]||(a[6]=o=>n.value.difficulty=o),required:"",class:"input"},[t("option",lt,"â­ "+s(e.$t("chores.veryEasy")),1),t("option",rt,"â­â­ "+s(e.$t("chores.easy")),1),t("option",it,"â­â­â­ "+s(e.$t("chores.medium")),1),t("option",dt,"â­â­â­â­ "+s(e.$t("chores.hard")),1),t("option",ut,"â­â­â­â­â­ "+s(e.$t("chores.veryHard")),1)],512),[[m,n.value.difficulty,void 0,{number:!0}]])]),t("div",null,[t("label",ct,s(e.$t("chores.priority")),1),d(t("select",{"onUpdate:modelValue":a[7]||(a[7]=o=>n.value.priority=o),required:"",class:"input"},[t("option",ht,s(e.$t("chores.veryLow")),1),t("option",pt,s(e.$t("chores.low")),1),t("option",vt,s(e.$t("chores.medium")),1),t("option",mt,s(e.$t("chores.high")),1),t("option",yt,s(e.$t("chores.veryHigh")),1)],512),[[m,n.value.priority,void 0,{number:!0}]])])]),t("div",_t,[t("div",null,[t("label",bt,s(e.$t("chores.assignmentMode")),1),d(t("select",{"onUpdate:modelValue":a[8]||(a[8]=o=>n.value.assignmentMode=o),required:"",class:"input"},[t("option",ft,s(e.$t("chores.autoLeastLoaded")),1),t("option",gt,s(e.$t("chores.manual")),1),t("option",$t,s(e.$t("chores.roundRobin")),1),t("option",kt,s(e.$t("chores.random")),1)],512),[[m,n.value.assignmentMode]])]),n.value.assignmentMode==="manual"?(r(),l("div",wt,[t("label",Dt,s(e.$t("chores.assignTo")),1),d(t("select",{"onUpdate:modelValue":a[9]||(a[9]=o=>n.value.manualAssigneeId=o),required:"",class:"input"},[t("option",Ct,s(e.$t("chores.selectUser")),1),(r(!0),l(M,null,S(w.value,o=>(r(),l("option",{key:o.id,value:o.id},s(o.name),9,It))),128))],512),[[m,n.value.manualAssigneeId]])])):(r(),l("div",Et,[t("label",Mt,s(e.$t("chores.reminderHours")),1),d(t("input",{"onUpdate:modelValue":a[10]||(a[10]=o=>n.value.reminderHours=o),type:"number",min:"0",max:"168",class:"input",placeholder:"24"},null,512),[[U,n.value.reminderHours,void 0,{number:!0}]])]))]),t("div",St,[d(t("input",{"onUpdate:modelValue":a[11]||(a[11]=o=>n.value.notificationsEnabled=o),type:"checkbox",id:"notifications",class:"w-4 h-4"},null,512),[[oe,n.value.notificationsEnabled]]),t("label",Ut,s(e.$t("chores.enableNotifications")),1)]),t("button",{type:"submit",disabled:D.value,class:"btn btn-primary"},s(D.value?e.$t("chores.creating"):e.$t("chores.addChore")),9,qt)],32)])):u("",!0),t("div",xt,[t("div",Vt,[t("div",null,[t("label",At,s(e.$t("chores.status")),1),d(t("select",{"onUpdate:modelValue":a[12]||(a[12]=o=>c.value.status=o),onChange:g,class:"input"},[t("option",Lt,s(e.$t("chores.all")),1),t("option",Pt,s(e.$t("chores.pending")),1),t("option",Ft,s(e.$t("chores.inProgress")),1),t("option",Tt,s(e.$t("chores.done")),1),t("option",Ht,s(e.$t("chores.overdue")),1)],544),[[m,c.value.status]])]),y(v).hasPermission("chores.read")?(r(),l("div",Nt,[t("label",Ot,s(e.$t("common.user")),1),d(t("select",{"onUpdate:modelValue":a[13]||(a[13]=o=>c.value.userId=o),onChange:g,class:"input"},[t("option",Rt,s(e.$t("chores.everyone")),1),(r(!0),l(M,null,S(w.value,o=>(r(),l("option",{key:o.id,value:o.id},s(o.name),9,Bt))),128))],544),[[m,c.value.userId]])])):u("",!0),t("div",null,[t("label",jt,s(e.$t("chores.sortByLabel")),1),d(t("select",{"onUpdate:modelValue":a[14]||(a[14]=o=>c.value.sortBy=o),onChange:K,class:"input"},[t("option",zt,s(e.$t("chores.deadline")),1),t("option",Gt,s(e.$t("chores.priority")),1),t("option",Jt,s(e.$t("chores.difficulty")),1),t("option",Kt,s(e.$t("chores.points")),1)],544),[[m,c.value.sortBy]])])])]),t("div",Qt,[x.value?(r(),l("div",Wt,s(e.$t("common.loading")),1)):!A.value||A.value.length===0?(r(),l("div",Xt,s(e.$t("chores.noChores")),1)):(r(),l("div",Yt,[(r(!0),l(M,null,S(A.value,o=>(r(),l("div",{key:o.id,class:"p-4 rounded-xl bg-gray-700/30 hover:bg-gray-700/50 transition-colors"},[t("div",Zt,[t("div",es,[t("div",ts,[t("h3",ss,s(o.chore?.name||e.$t("chores.unknownChore")),1),o.chore?.difficulty?(r(),l("span",os,s("â­".repeat(o.chore.difficulty)),1)):u("",!0),o.chore?.priority>=4?(r(),l("span",as,s(e.$t("chores.highPriority")),1)):u("",!0)]),o.chore?.description?(r(),l("p",ns,s(o.chore.description),1)):u("",!0),t("div",ls,[t("span",rs," ðŸ‘¤ "+s(o.userName),1),t("span",is," ðŸ“… "+s(Q(o.dueDate)),1),t("span",{class:B(X(o.status))},s(W(o.status)),3),t("span",ds," ðŸ’Ž "+s(o.points)+" "+s(e.$t("chores.pts")),1),o.status==="done"&&o.isOnTime?(r(),l("span",us," âš¡ "+s(e.$t("chores.onTime")),1)):u("",!0)])]),t("div",cs,[o.status==="pending"&&o.assigneeUserId===y(v).user?.id?(r(),l("button",{key:0,onClick:p=>N(o.id,"in_progress"),class:"btn btn-sm btn-outline"},s(e.$t("chores.start")),9,hs)):u("",!0),o.status==="in_progress"&&o.assigneeUserId===y(v).user?.id?(r(),l("button",{key:1,onClick:p=>N(o.id,"done"),class:"btn btn-sm btn-primary"},s(e.$t("chores.markDone")),9,ps)):u("",!0),y(v).hasPermission("chores.delete")?(r(),l("button",{key:2,onClick:p=>J(o.chore?.id),disabled:C.value===o.chore?.id,class:"btn btn-sm btn-error"},s(C.value===o.chore?.id?e.$t("chores.deleting"):e.$t("chores.delete")),9,vs)):u("",!0)])])]))),128))]))])]))}};export{bs as default};
